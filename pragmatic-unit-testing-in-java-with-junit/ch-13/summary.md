# 13장 | 까다로운 테스트

<br>

## 멀티스레드 코드 테스트

사실 동시성 처리가 필요한 어플리케이션 코드를 테스트하는 것은 기술적으로 단위 테스트의 영역이 아닌, 통합 테스트에 가깝다.

### 스레드 통제와 어플리케이션 코드 사이의 중첩을 최소화하라
- 어플리케이션 로직과 스레드 로직이 분리되도록 __설계__를 변경하라
- 어플리케이션 로직은 기존의 테스트 작성 방법대로 작성하라
- 남은 스레드 로직 코드에 대해서만 스레드에 집중하는 테스트를 `Mock`을 활용하여 작성하라

### 유용성이 검증된 동시성 유틸리티 클래스를 활용하라
- 직접 스레드 문제를 해결하려 하지 마라
- `BlockingQueue` 등의 클래스를 활용하여 효율적으로 코딩하라

<br>

## 데이터베이스 테스트

### 데이터베이스와 실제 상호 작용하는 클래스를 분리하라

진짜 데이터베이스와 성공적으로 상호 작용하는 클래스에 대한 테스트를 작성하라. 

### 데이터 문제

#### 테스트 안에서 데이터를 생성하고 관리하라
- 실제 데이터베이스에 데이터를 쌓고 그것을 바탕으로 테스트하는 것은 테스트가 어려워지는 지름길이다
- 테스트마타 새로운 데이터베이스를 시작하여 테스트 간 데이터 의존성 문제를 해결할 수 있다
- 공유된 데이터베이스라면 트랜잭션을 통해 데이터를 관리하라

### Mock 처리
- 데이터베이스와의 상호 작용을 Mock으로 처리하고 나머지 로직을 검증하라

<br>

> 관심사를 분리하세요. 어플리케이션 로직과 스레드, DB 혹은 문제를 일으킬 수 있는 다른 의존성과 분리하세요.
> 느리거나 휘발적인 코드는 Mock으로 대체하여 단위 테스트의 의존성을 끊으세요.
> 필요한 경우에는 통합 테스트를 작성하되, 단순하고 집중적으로 만드세요.
